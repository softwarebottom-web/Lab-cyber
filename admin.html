<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>SYSTEM_ADMIN | AUTHORIZATION</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #000; color: #ff0000; font-family: 'Courier New', monospace; }
        .glitch { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        input { background: #080808 !important; border: 1px solid #222 !important; color: #ff0000 !important; }
        input:focus { border-color: #ff0000 !important; box-shadow: 0 0 10px #ff000030; }
    </style>
</head>
<body class="h-screen flex items-center justify-center">
    <div class="w-full max-w-xs p-8 border border-zinc-900 bg-zinc-950/50">
        <div class="text-center mb-8">
            <h1 class="text-xs font-black tracking-[0.3em] uppercase glitch">Root_Access_Required</h1>
            <p class="text-[8px] text-zinc-600 mt-2 uppercase">Unauthorized access is a federal crime.</p>
        </div>

        <div class="space-y-4">
            <div>
                <label class="text-[9px] uppercase font-bold text-zinc-500">Master_Key</label>
                <input type="password" id="adminPass" class="w-full p-3 mt-1 text-xs outline-none transition-all" placeholder="••••••••">
            </div>
            <button onclick="attemptLogin()" class="w-full bg-red-900/20 border border-red-900 text-red-600 py-3 text-[10px] font-black uppercase hover:bg-red-600 hover:text-white transition-all">Authenticate</button>
        </div>
        
        <p class="text-[8px] text-center text-zinc-800 mt-6 uppercase tracking-widest">ZaneLab_Sentinel_v3.0</p>
    </div>

    <script type="module">
        import { auth, db, BACKEND_URL } from "./auth-system.js";
        import { getDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // 1. Jebakan Inspect Element (Debugger Trap)
        setInterval(() => {
            const start = performance.now();
            debugger; // Akan memicu pause jika DevTools terbuka
            if (performance.now() - start > 100) {
                captureOffender("INSPECT_ELEMENT_DETECTION");
            }
        }, 1000);

        // 2. Logic Autentikasi Admin
        window.attemptLogin = async () => {
            const pass = document.getElementById('adminPass').value;
            const user = auth.currentUser;

            if (!user) {
                alert("Login to your member account first.");
                return;
            }

            // Ambil Role Asli dari Database (Server-Side Check)
            const snap = await getDoc(doc(db, "users", user.uid));
            const role = snap.data().role;

            if (pass === "XSTAR") {
                if (role === "ADMIN") {
                    // Hanya Zane (ADMIN asli) yang bisa lewat
                    alert("Identity Verified. Welcome Zane.");
                    window.location.href = "real-panel-admin.html";
                } else {
                    // PASSWORD BENAR, TAPI ROLE BUKAN ADMIN -> TIKUS TERDETEKSI!
                    captureOffender("ILLEGAL_ROLE_ACCESS_ATTEMPT");
                }
            } else {
                // Password Salah -> Brute Force Attempt
                captureOffender("WRONG_PASSWORD_BRUTEFORCE");
            }
        };

        async function captureOffender(reason) {
            const user = auth.currentUser;
            
            // Kirim data ke Police Bot (Backend Railway)
            try {
                await fetch(`${BACKEND_URL}/report-sabotage`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        uid: user ? user.uid : "ANONYMOUS",
                        email: user ? user.email : "UNKNOWN",
                        reason: reason,
                        timestamp: new Date().toISOString()
                    })
                });
            } catch (e) { console.error("Sentinel failed to report."); }

            // Lempar ke halaman Honeypot
            window.location.href = "honeypot.html";
        }
    </script>
</body>
</html>
