<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>MATRIX_ROOM | ANONYMOUS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #000; color: #0f0; font-family: 'Courier New', monospace; overflow: hidden; }
        .chat-box { height: 70vh; overflow-y: auto; scroll-behavior: smooth; border: 1px solid #111; }
        .chat-box::-webkit-scrollbar { width: 3px; }
        .chat-box::-webkit-scrollbar-thumb { background: #0f0; }
        .input-area { background: #050505; border-top: 1px solid #111; }
        .system-msg { color: #555; font-size: 10px; }
        .glitch { animation: glitch 1s infinite; }
        @keyframes glitch { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
    </style>
</head>
<body class="flex flex-col h-screen p-4">
    <div class="flex justify-between items-center mb-4 border-b border-zinc-900 pb-2">
        <h1 class="text-xs font-black tracking-widest glitch uppercase">// DARKNET_IRC: DARK_ROOM_01</h1>
        <div class="text-[10px] text-zinc-500 uppercase">Status: <span class="text-red-600 animate-pulse">Encrypted</span></div>
    </div>

    <div id="login-overlay" class="fixed inset-0 bg-black z-50 flex items-center justify-center">
        <div class="w-80 p-8 border border-zinc-900 bg-zinc-950 text-center">
            <h2 class="text-xs font-bold mb-6 text-white uppercase tracking-widest">Enter Burner Identity</h2>
            <input type="text" id="alias" placeholder="ALIAS (e.g. MRX)" class="w-full bg-black border border-zinc-800 p-3 text-xs mb-4 outline-none text-green-500">
            <input type="email" id="burner-email" placeholder="BURNER_EMAIL" class="w-full bg-black border border-zinc-800 p-3 text-xs mb-6 outline-none text-green-500">
            <button onclick="joinMatrix()" class="w-full bg-green-900/20 border border-green-600 text-green-500 py-3 text-[10px] font-black uppercase hover:bg-green-600 hover:text-black transition">Connect_To_Node</button>
            <p class="text-[8px] text-zinc-700 mt-4 italic">Note: ZaneLab Account is NOT used here for safety.</p>
        </div>
    </div>

    <div id="chat-container" class="chat-box p-4 space-y-2 flex flex-col">
        <div class="system-msg">*** NODE_CONNECTED: IP_MASKED_SUCCESSFULLY ***</div>
        <div class="system-msg">*** E2EE_ESTABLISHED: NO_LOGS_ENABLED ***</div>
    </div>

    <div class="input-area p-4 fixed bottom-0 left-0 w-full flex gap-4">
        <span id="current-alias" class="text-white font-bold text-xs pt-2">? ></span>
        <input type="text" id="msg-input" placeholder="Type secret message..." class="flex-1 bg-transparent text-xs outline-none border-b border-zinc-900 focus:border-green-600 py-2">
        <button onclick="sendMessage()" class="text-xs font-bold hover:text-white transition">SEND</button>
    </div>

    <script type="module">
        import { db } from "./auth-system.js";
        import { collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        let myAlias = "";

        window.joinMatrix = () => {
            const alias = document.getElementById('alias').value;
            const email = document.getElementById('burner-email').value;
            if(alias && email) {
                myAlias = alias;
                document.getElementById('current-alias').innerText = myAlias + " >";
                document.getElementById('login-overlay').style.display = 'none';
                loadMessages();
            } else { alert("Data incomplete."); }
        };

        window.sendMessage = async () => {
            const input = document.getElementById('msg-input');
            if(input.value) {
                await addDoc(collection(db, "matrix_chats"), {
                    alias: myAlias,
                    msg: input.value,
                    timestamp: serverTimestamp()
                });
                input.value = "";
            }
        };

        function loadMessages() {
            const q = query(collection(db, "matrix_chats"), orderBy("timestamp", "asc"), limit(50));
            onSnapshot(q, (snapshot) => {
                const chatBox = document.getElementById('chat-container');
                chatBox.innerHTML = ""; // Reset for visual clean
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    const div = document.createElement('div');
                    div.className = "text-xs";
                    div.innerHTML = `<span class="text-white font-bold">[${data.alias}]</span>: <span class="text-green-400">${data.msg}</span>`;
                    chatBox.appendChild(div);
                });
                chatBox.scrollTop = chatBox.scrollHeight;
            });
        }

        // Enter key support
        document.getElementById('msg-input').addEventListener('keypress', (e) => {
            if(e.key === 'Enter') sendMessage();
        });
    </script>
</body>
</html>
